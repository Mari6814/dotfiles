# Mark zshrc as source
export ZSHRC="${(%):-%x}:$ZSHRC"
export SOURCED="${(%):-%x}:$SOURCED"

# Check if zplug is installed
if [[ ! -d ~/.zplug ]]; then
  git clone https://github.com/zplug/zplug ~/.zplug
  source ~/.zplug/init.zsh && zplug update --self
fi

# Essential
source ~/.zplug/init.zsh
# Make sure to use double quotes to prevent shell expansion
# zplug "zsh-users/zsh-syntax-highlighting"
zplug "zsh-users/zsh-autosuggestions"
# Install packages that have not been installed yet
if ! zplug check --verbose; then
    printf "Install? [y/N]: "
    if read -q; then
        echo; zplug install
    else
        echo
    fi
fi
zplug load

# Accept autosuggestion provided by the zplugin zsh-autosuggestions
bindkey '^F' autosuggest-accept
# ZSH default ^D behaviour is list-choices for some reason...
# bindkey '^D' vi-kill-line


setopt auto_cd
setopt append_history

export PROMPT="%F{blue}%n%F{green}:%F{cyan}%~%F{green}$ %F{reset}"

alias ls="ls -FG --color=auto"
alias l=ls
alias la="ls -A"
alias ll="ls -Flh"
alias lla="ls -AFGlh"
alias c=clear
alias gs="git status"
alias gv="git remote -v"
alias gd="git diff"
alias gcam="git commit -am"
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .....="cd ../../../.."
[ ! -z "$EDITOR" ] && alias e="$EDITOR"
alias vim=nvim
_sourceedit() { e "$1" && source "$1"; }
alias eprofile="_sourceedit ~/.zprofile"
alias erc="_sourceedit ~/.zshrc"
alias eenv="_sourceedit ~/.zshenv"
alias mkdir="mkdir -pv"
mkcdir() { mkdir "$1" && cd "$1"; }
alias evim="e ~/.vimrc"
alias ports="netstat -tulanp"
alias follow="tail -f"
alias aptuu="sudo apt-get update && sudo apt-get upgrade"
alias m="python -m"
alias p="poetry"
alias va="source .venv/bin/activate"
alias jn="jupyter notebook"

# NPM setup
if command -v npm &> /dev/null; then
    export NPM_PREFIX="$HOME/.local/npm"
    if [[ ! "$(npm config get prefix)" == "$NPM_PREFIX" ]]; then
        echo "npm is installed: Setting install directory to $NPM_PREFIX" >&2
        npm config set prefix "$NPM_PREFIX"
    fi
    # Add globally installed packages to PATH
    export PATH="$(npm config get prefix)/bin:$PATH"
    # Also add all npm_modules executables to path
    export PATH="./npm_modules/bin:$PATH"
fi

if [ -d "$LOCAL/zshrc" ]; then
    source "$LOCAL/zshrc"
fi
